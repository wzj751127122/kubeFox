"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[280],{6280:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});var l=t(3396),s=t(7139);const n=e=>((0,l.dD)("data-v-733980bc"),e=e(),(0,l.Cn)(),e),m={class:"deploy"},o=n((()=>(0,l._)("span",null,"命名空间: ",-1))),r=(0,l.Uk)("刷新"),p=(0,l.Uk)("创建"),i=(0,l.Uk)("搜索"),c={class:"deploy-body-deployname"},d=(0,l.Uk)("YAML"),u=(0,l.Uk)("扩缩"),h=(0,l.Uk)("重启"),g=(0,l.Uk)("删除"),y=n((()=>(0,l._)("h4",null,"创建Deployment",-1))),D=(0,l.Uk)("取消"),w=(0,l.Uk)("立即创建"),f={class:"dialog-footer"},_=(0,l.Uk)("取 消"),b=(0,l.Uk)("更 新"),W={style:{"text-align":"center"}},V=n((()=>(0,l._)("span",null,"实例数: ",-1))),k={class:"dialog-footer"},C=(0,l.Uk)("取 消"),v=(0,l.Uk)("更 新");function U(e,a,t,n,U,z){const x=(0,l.up)("el-option"),L=(0,l.up)("el-select"),$=(0,l.up)("el-col"),Y=(0,l.up)("el-button"),S=(0,l.up)("el-row"),I=(0,l.up)("el-card"),N=(0,l.up)("el-input"),j=(0,l.up)("el-table-column"),T=(0,l.up)("el-tag"),P=(0,l.up)("el-popover"),F=(0,l.up)("el-table"),R=(0,l.up)("el-pagination"),O=(0,l.up)("el-form-item"),q=(0,l.up)("el-input-number"),E=(0,l.up)("WarningFilled"),Z=(0,l.up)("el-icon"),A=(0,l.up)("el-switch"),G=(0,l.up)("el-form"),H=(0,l.up)("el-drawer"),K=(0,l.up)("codemirror"),M=(0,l.up)("el-dialog"),B=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{span:24},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(I,{class:"deploy-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{span:6},{default:(0,l.w5)((()=>[(0,l._)("div",null,[o,(0,l.Wm)(L,{modelValue:U.namespaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>U.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(U.namespaceList,((e,a)=>((0,l.wg)(),(0,l.j4)(x,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,l.Wm)($,{span:2,offset:16},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(Y,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:a[1]||(a[1]=e=>z.getDeployments())},{default:(0,l.w5)((()=>[r])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,l.Wm)($,{span:24},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(I,{class:"deploy-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{span:2},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(Y,{style:{"border-radius":"2px"},icon:"Edit",type:"primary",onClick:a[2]||(a[2]=e=>U.createDeploymentDrawer=!0)},{default:(0,l.w5)((()=>[p])),_:1})),[[B,U.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])])])),_:1}),(0,l.Wm)($,{span:6},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(N,{class:"deploy-head-search",clearable:"",placeholder:"请输入",modelValue:U.searchInput,"onUpdate:modelValue":a[3]||(a[3]=e=>U.searchInput=e)},null,8,["modelValue"]),(0,l.Wm)(Y,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:a[4]||(a[4]=e=>z.getDeployments())},{default:(0,l.w5)((()=>[i])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,l.Wm)($,{span:24},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(I,{class:"deploy-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.j4)(F,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:U.deploymentList},{default:(0,l.w5)((()=>[(0,l.Wm)(j,{width:"20"}),(0,l.Wm)(j,{align:"left",label:"Deployment名"},{default:(0,l.w5)((e=>[(0,l._)("a",c,(0,s.zw)(e.row.metadata.name),1)])),_:1}),(0,l.Wm)(j,{align:"center",label:"标签"},{default:(0,l.w5)((e=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.row.metadata.labels,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.Wm)(P,{placement:"right",width:200,trigger:"hover",content:a+":"+e},{reference:(0,l.w5)((()=>[(0,l.Wm)(T,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(z.ellipsis(a+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,l.Wm)(j,{align:"center",label:"容器组"},{default:(0,l.w5)((e=>[(0,l._)("span",null,(0,s.zw)(e.row.status.availableReplicas>0?e.row.status.availableReplicas:0)+" / "+(0,s.zw)(e.row.spec.replicas>0?e.row.spec.replicas:0),1)])),_:1}),(0,l.Wm)(j,{align:"center","min-width":"100",label:"创建时间"},{default:(0,l.w5)((e=>[(0,l.Wm)(T,{type:"info"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(z.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,l.Wm)(j,{align:"center",label:"镜像"},{default:(0,l.w5)((e=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.row.spec.template.spec.containers,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.Wm)(P,{placement:"right",width:200,trigger:"hover",content:e.image},{reference:(0,l.w5)((()=>[(0,l.Wm)(T,{style:{"margin-bottom":"5px"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(z.ellipsis(void 0==e.image.split("/")[2]?e.image:e.image.split("/")[2])),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,l.Wm)(j,{align:"center",label:"操作",width:"400"},{default:(0,l.w5)((e=>[(0,l.Wm)(Y,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:a=>z.getDeploymentDetail(e)},{default:(0,l.w5)((()=>[d])),_:2},1032,["onClick"]),(0,l.Wm)(Y,{size:"small",style:{"border-radius":"2px"},icon:"Plus",type:"primary",onClick:a=>z.handleScale(e)},{default:(0,l.w5)((()=>[u])),_:2},1032,["onClick"]),(0,l.Wm)(Y,{size:"small",style:{"border-radius":"2px"},icon:"RefreshLeft",type:"primary",onClick:a=>z.handleConfirm(e,"重启",z.restartDeployment)},{default:(0,l.w5)((()=>[h])),_:2},1032,["onClick"]),(0,l.Wm)(Y,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:a=>z.handleConfirm(e,"删除",z.delDeployment)},{default:(0,l.w5)((()=>[g])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[B,U.appLoading]]),(0,l.Wm)(R,{class:"deploy-body-pagination",background:"",onSizeChange:z.handleSizeChange,onCurrentChange:z.handleCurrentChange,"current-page":U.currentPage,"page-sizes":U.pagesizeList,"page-size":U.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:U.deploymentTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,l.Wm)(H,{modelValue:U.createDeploymentDrawer,"onUpdate:modelValue":a[16]||(a[16]=e=>U.createDeploymentDrawer=e),direction:U.direction,"before-close":z.handleClose},{title:(0,l.w5)((()=>[y])),default:(0,l.w5)((()=>[(0,l.Wm)(S,{type:"flex",justify:"center"},{default:(0,l.w5)((()=>[(0,l.Wm)($,{span:20},{default:(0,l.w5)((()=>[(0,l.Wm)(G,{ref:"createDeployment",rules:U.createDeploymentRules,model:U.createDeployment,"label-width":"80px"},{default:(0,l.w5)((()=>[(0,l.Wm)(O,{class:"deploy-create-form",label:"名称",prop:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{modelValue:U.createDeployment.name,"onUpdate:modelValue":a[5]||(a[5]=e=>U.createDeployment.name=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"命名空间",prop:"namespace"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{modelValue:U.createDeployment.namespace,"onUpdate:modelValue":a[6]||(a[6]=e=>U.createDeployment.namespace=e),filterable:"",placeholder:"请选择"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(U.namespaceList,((e,a)=>((0,l.wg)(),(0,l.j4)(x,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"副本数",prop:"replicas"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{modelValue:U.createDeployment.replicas,"onUpdate:modelValue":a[7]||(a[7]=e=>U.createDeployment.replicas=e),min:1,max:10},null,8,["modelValue"]),(0,l.Wm)(P,{placement:"top",width:100,trigger:"hover",content:"申请副本数上限为10个"},{reference:(0,l.w5)((()=>[(0,l.Wm)(Z,{style:{width:"2em","font-size":"18px",color:"#4795EE"}},{default:(0,l.w5)((()=>[(0,l.Wm)(E)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"镜像",prop:"image"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{modelValue:U.createDeployment.image,"onUpdate:modelValue":a[8]||(a[8]=e=>U.createDeployment.image=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"标签",prop:"label_str"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{modelValue:U.createDeployment.label_str,"onUpdate:modelValue":a[9]||(a[9]=e=>U.createDeployment.label_str=e),placeholder:"示例: project=ms,app=gateway"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"资源配额",prop:"resource"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{modelValue:U.createDeployment.resource,"onUpdate:modelValue":a[10]||(a[10]=e=>U.createDeployment.resource=e),placeholder:"请选择"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{value:"0.5/1",label:"0.5C1G"}),(0,l.Wm)(x,{value:"1/2",label:"1C2G"}),(0,l.Wm)(x,{value:"2/4",label:"2C4G"}),(0,l.Wm)(x,{value:"4/8",label:"4C8G"})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"容器端口",prop:"container_port"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{modelValue:U.createDeployment.container_port,"onUpdate:modelValue":a[11]||(a[11]=e=>U.createDeployment.container_port=e),placeholder:"示例: 80"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"健康检查",prop:"health"},{default:(0,l.w5)((()=>[(0,l.Wm)(A,{modelValue:U.createDeployment.health_check,"onUpdate:modelValue":a[12]||(a[12]=e=>U.createDeployment.health_check=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,{class:"deploy-create-form",label:"检查路径",prop:"healthPath"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{modelValue:U.createDeployment.health_path,"onUpdate:modelValue":a[13]||(a[13]=e=>U.createDeployment.health_path=e),placeholder:"示例: /health"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1})])),_:1})])),footer:(0,l.w5)((()=>[(0,l.Wm)(Y,{onClick:a[14]||(a[14]=e=>U.createDeploymentDrawer=!1)},{default:(0,l.w5)((()=>[D])),_:1}),(0,l.Wm)(Y,{type:"primary",onClick:a[15]||(a[15]=e=>z.submitForm("createDeployment"))},{default:(0,l.w5)((()=>[w])),_:1})])),_:1},8,["modelValue","direction","before-close"]),(0,l.Wm)(M,{title:"YAML信息",modelValue:U.yamlDialog,"onUpdate:modelValue":a[20]||(a[20]=e=>U.yamlDialog=e),width:"45%",top:"2%"},{footer:(0,l.w5)((()=>[(0,l._)("span",f,[(0,l.Wm)(Y,{onClick:a[18]||(a[18]=e=>this.yamlDialog=!1)},{default:(0,l.w5)((()=>[_])),_:1}),(0,l.Wm)(Y,{type:"primary",onClick:a[19]||(a[19]=e=>z.updateDeployment())},{default:(0,l.w5)((()=>[b])),_:1})])])),default:(0,l.w5)((()=>[(0,l.Wm)(K,{value:U.contentYaml,"onUpdate:value":a[17]||(a[17]=e=>U.contentYaml=e),border:"",options:U.cmOptions,style:{height:"500px"},autofocus:!0,"tab-size":2,onChange:z.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"]),(0,l.Wm)(M,{title:"副本数调整",modelValue:U.scaleDialog,"onUpdate:modelValue":a[24]||(a[24]=e=>U.scaleDialog=e),width:"25%"},{footer:(0,l.w5)((()=>[(0,l._)("span",k,[(0,l.Wm)(Y,{onClick:a[22]||(a[22]=e=>U.scaleDialog=!1)},{default:(0,l.w5)((()=>[C])),_:1}),(0,l.Wm)(Y,{type:"primary",onClick:a[23]||(a[23]=e=>z.scaleDeployment())},{default:(0,l.w5)((()=>[v])),_:1})])])),default:(0,l.w5)((()=>[(0,l._)("div",W,[V,(0,l.Wm)(q,{step:1,modelValue:U.scaleNum,"onUpdate:modelValue":a[21]||(a[21]=e=>U.scaleNum=e),min:0,max:30,label:"描述文字"},null,8,["modelValue"])])])),_:1},8,["modelValue"])])}var z=t(7973),x=t(5959),L=t(1391),$=t(4583),Y=t(3794),S={data(){return{cmOptions:{mode:"text/yaml",theme:"darcula",lineNumbers:!0,smartIndent:!0,indentUnit:4,styleActiveLine:!0,matchBrackets:!0,readOnly:!1,lineWrapping:!0},contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,deploymentList:[],deploymentTotal:0,getDeploymentsData:{url:z.Z.k8sDeploymentList,params:{filter_name:"",namespace:"",page:"",limit:""}},fullscreenLoading:!1,direction:"rtl",createDeploymentDrawer:!1,createDeployment:{name:"",namespace:"",replicas:1,image:"",resource:"",health_check:!1,health_path:"",label_str:"",label:{},container_port:""},createDeploymentData:{url:z.Z.k8sDeploymentCreate,params:{}},createDeploymentRules:{name:[{required:!0,message:"请填写名称",trigger:"change"}],image:[{required:!0,message:"请填写镜像",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],resource:[{required:!0,message:"请选择配额",trigger:"change"}],label_str:[{required:!0,message:"请填写标签",trigger:"change"}],container_port:[{required:!0,message:"请填写容器端口",trigger:"change"}]},deploymentDetail:{},getDeploymentDetailData:{params:{deployment_name:"",namespace:""}},yamlDialog:!1,updateDeploymentData:{params:{namespace:"",content:""}},scaleNum:0,scaleDialog:!1,scaleDeploymentData:{params:{deployment_name:"",namespace:"",scale_num:""}},restartDeploymentData:{params:{deployment_name:"",namespace:""}},delDeploymentData:{params:{deployment_name:"",namespace:""}}}},methods:{transYaml(e){return L.stringify(e)},transObj(e){return x.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getDeployments()},handleCurrentChange(e){this.currentPage=e,this.getDeployments()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let a=new Date(new Date(e).getTime()+288e5);return a=a.toJSON(),a=a.substring(0,19).replace("T"," "),a},getNamespaces(){(0,Y.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getDeployments(){this.appLoading=!0,this.getDeploymentsData.params.filter_name=this.searchInput,this.getDeploymentsData.params.namespace=this.namespaceValue,this.getDeploymentsData.params.page=this.currentPage,this.getDeploymentsData.params.limit=this.pagesize,(0,$.H4)(this.getDeploymentsData.params).then((e=>{this.deploymentList=e.data.items,this.deploymentTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getDeploymentDetail(e){this.getDeploymentDetailData.params.deployment_name=e.row.metadata.name,this.getDeploymentDetailData.params.namespace=this.namespaceValue,(0,$.mj)(this.getDeploymentDetailData.params).then((e=>{this.deploymentDetail=e.data,this.contentYaml=this.transYaml(this.deploymentDetail),console.log(this.contentYaml),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateDeployment(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateDeploymentData.params.namespace=this.namespaceValue,this.updateDeploymentData.params.content=e,(0,$.RL)(this.updateDeploymentData.params).then((e=>{this.$message.success({message:e.msg}),this.getDeployments()})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},handleScale(e){this.scaleDialog=!0,this.deploymentDetail=e.row,this.scaleNum=e.row.spec.replicas},scaleDeployment(){this.scaleDeploymentData.params.deployment_name=this.deploymentDetail.metadata.name,this.scaleDeploymentData.params.namespace=this.namespaceValue,this.scaleDeploymentData.params.scale_num=this.scaleNum,(0,$._m)(this.scaleDeploymentData.params).then((e=>{this.$message.success({message:e.msg}),this.getDeployments()})).catch((e=>{this.$message.error({message:e.msg})})),this.scaleDialog=!1},restartDeployment(e){this.restartDeploymentData.params.deployment_name=e.row.metadata.name,this.restartDeploymentData.params.namespace=this.namespaceValue,(0,$.X)(this.restartDeploymentData.params).then((e=>{this.$message.success({message:e.msg}),this.getDeployments()})).catch((e=>{this.$message.error({message:e.msg})}))},delDeployment(e){this.delDeploymentData.params.deployment_name=e.row.metadata.name,this.delDeploymentData.params.namespace=this.namespaceValue,(0,$.tN)(this.delDeploymentData.params).then((e=>{this.$message.success({message:e.msg}),this.getDeployments()})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,a,t){this.confirmContent="确认继续 "+a+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{t(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))},createDeployFunc(){let e=new RegExp("(^[A-Za-z]+=[A-Za-z0-9]+).*");if(!e.test(this.createDeployment.label_str))return void this.$message.warning({message:"标签填写异常，请确认后重新填写"});this.fullscreenLoading=!0;let a,t,l=new Map,s=this.createDeployment.label_str.split(",");s.forEach((e=>{let a=e.split("=");l[a[0]]=a[1]}));let n=this.createDeployment.resource.split("/");a=n[0],t=n[1]+"Gi",this.createDeploymentData.params=this.createDeployment,this.createDeploymentData.params.container_port=parseInt(this.createDeployment.container_port),this.createDeploymentData.params.label=l,this.createDeploymentData.params.cpu=a,this.createDeploymentData.params.memory=t,(0,$.Pv)(this.createDeploymentData.params).then((e=>{this.$message.success({message:e.msg}),this.getDeployments()})).catch((e=>{this.$message.error({message:e.msg})})),this.resetForm("createDeployment"),this.fullscreenLoading=!1,this.createDeploymentDrawer=!1},resetForm(e){this.$refs[e].resetFields()},submitForm(e){this.$refs[e].validate((e=>{if(!e)return!1;this.createDeployFunc()}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getDeployments()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getDeployments()}},I=t(89);const N=(0,I.Z)(S,[["render",U],["__scopeId","data-v-733980bc"]]);var j=N}}]);
//# sourceMappingURL=280.69d67885.js.map