"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[858],{9220:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var n=t(3396),s=t(7139);const l=e=>((0,n.dD)("data-v-bf904038"),e=e(),(0,n.Cn)(),e),m={class:"daemonset"},i=l((()=>(0,n._)("span",null,"命名空间: ",-1))),o=(0,n.Uk)("刷新"),r=(0,n.Uk)("创建"),d=(0,n.Uk)("搜索"),p={class:"daemonset-body-daemonsetname"},u=(0,n.Uk)("YAML"),c=(0,n.Uk)("删除"),g={class:"dialog-footer"},h=(0,n.Uk)("取 消"),w=(0,n.Uk)("更 新");function D(e,a,t,l,D,f){const S=(0,n.up)("el-option"),_=(0,n.up)("el-select"),b=(0,n.up)("el-col"),y=(0,n.up)("el-button"),W=(0,n.up)("el-row"),C=(0,n.up)("el-card"),k=(0,n.up)("el-input"),v=(0,n.up)("el-table-column"),z=(0,n.up)("el-tag"),V=(0,n.up)("el-popover"),x=(0,n.up)("el-table"),L=(0,n.up)("el-pagination"),U=(0,n.up)("codemirror"),Y=(0,n.up)("el-dialog"),T=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",m,[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(C,{class:"daemonset-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[i,(0,n.Wm)(_,{modelValue:D.namespaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>D.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(D.namespaceList,((e,a)=>((0,n.wg)(),(0,n.j4)(S,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,n.Wm)(b,{span:2,offset:16},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(y,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:a[1]||(a[1]=e=>f.getDaemonSets())},{default:(0,n.w5)((()=>[o])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(C,{class:"daemonset-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:2},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(y,{disabled:"",style:{"border-radius":"2px"},icon:"Edit",type:"primary"},{default:(0,n.w5)((()=>[r])),_:1})])])),_:1}),(0,n.Wm)(b,{span:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(k,{class:"daemonset-head-search",clearable:"",placeholder:"请输入",modelValue:D.searchInput,"onUpdate:modelValue":a[2]||(a[2]=e=>D.searchInput=e)},null,8,["modelValue"]),(0,n.Wm)(y,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:a[3]||(a[3]=e=>f.getDaemonSets())},{default:(0,n.w5)((()=>[d])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(C,{class:"daemonset-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,n.w5)((()=>[(0,n.wy)(((0,n.wg)(),(0,n.j4)(x,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:D.daemonSetList},{default:(0,n.w5)((()=>[(0,n.Wm)(v,{width:"20"}),(0,n.Wm)(v,{align:"left",label:"DaemonSet名"},{default:(0,n.w5)((e=>[(0,n._)("a",p,(0,s.zw)(e.row.metadata.name),1)])),_:1}),(0,n.Wm)(v,{align:"center",label:"标签"},{default:(0,n.w5)((e=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.row.metadata.labels,((e,a)=>((0,n.wg)(),(0,n.iD)("div",{key:a},[(0,n.Wm)(V,{placement:"right",width:200,trigger:"hover",content:a+":"+e},{reference:(0,n.w5)((()=>[(0,n.Wm)(z,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(f.ellipsis(a+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,n.Wm)(v,{align:"center",label:"容器组"},{default:(0,n.w5)((e=>[(0,n._)("span",null,(0,s.zw)(e.row.status.numberAvailable>0?e.row.status.numberAvailable:0)+" / "+(0,s.zw)(e.row.status.desiredNumberScheduled>0?e.row.status.desiredNumberScheduled:0),1)])),_:1}),(0,n.Wm)(v,{align:"center","min-width":"100",label:"创建时间"},{default:(0,n.w5)((e=>[(0,n.Wm)(z,{type:"info"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(f.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,n.Wm)(v,{align:"center",label:"镜像"},{default:(0,n.w5)((e=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.row.spec.template.spec.containers,((e,a)=>((0,n.wg)(),(0,n.iD)("div",{key:a},[(0,n.Wm)(V,{placement:"right",width:200,trigger:"hover",content:e.image},{reference:(0,n.w5)((()=>[(0,n.Wm)(z,{style:{"margin-bottom":"5px"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(f.ellipsis(void 0==e.image.split("/")[2]?e.image:e.image.split("/")[2])),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,n.Wm)(v,{align:"center",label:"操作",width:"200"},{default:(0,n.w5)((e=>[(0,n.Wm)(y,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:a=>f.getDaemonSetDetail(e)},{default:(0,n.w5)((()=>[u])),_:2},1032,["onClick"]),(0,n.Wm)(y,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:a=>f.handleConfirm(e,"删除",f.delDaemonSet)},{default:(0,n.w5)((()=>[c])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[T,D.appLoading]]),(0,n.Wm)(L,{class:"daemonset-body-pagination",background:"",onSizeChange:f.handleSizeChange,onCurrentChange:f.handleCurrentChange,"current-page":D.currentPage,"page-sizes":D.pagesizeList,"page-size":D.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:D.daemonSetTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,n.Wm)(Y,{title:"YAML信息",modelValue:D.yamlDialog,"onUpdate:modelValue":a[6]||(a[6]=e=>D.yamlDialog=e),width:"45%",top:"5%"},{footer:(0,n.w5)((()=>[(0,n._)("span",g,[(0,n.Wm)(y,{onClick:a[4]||(a[4]=e=>D.yamlDialog=!1)},{default:(0,n.w5)((()=>[h])),_:1}),(0,n.Wm)(y,{type:"primary",onClick:a[5]||(a[5]=e=>f.updateDaemonSet())},{default:(0,n.w5)((()=>[w])),_:1})])])),default:(0,n.w5)((()=>[(0,n.Wm)(U,{value:D.contentYaml,border:"",options:D.cmOptions,height:"500",style:{"font-size":"14px"},onChange:f.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"])])}var f=t(7973),S=t(4471),_=t(5959),b=t(1391),y=t(3794);function W(e){return(0,S.Z)({url:"/api/k8s/daemonset/list",method:"get",params:e})}function C(e){return(0,S.Z)({url:"/api/k8s/daemonset/detail",method:"get",params:e})}function k(e){return(0,S.Z)({url:"/api/k8s/daemonset/update",method:"put",params:e})}function v(e){return(0,S.Z)({url:"/api/k8s/daemonset/del",method:"delete",params:e})}var z={data(){return{cmOptions:f.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,daemonSetList:[],daemonSetTotal:0,getDaemonSetsData:{params:{filter_name:"",namespace:"",page:"",limit:""}},daemonSetDetail:{},getDaemonSetDetailData:{params:{name:"",namespace:""}},yamlDialog:!1,updateDaemonSetData:{params:{namespace:"",content:""}},delDaemonSetData:{params:{daemonset_name:"",namespace:""}}}},methods:{transYaml(e){return b.stringify(e)},transObj(e){return _.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getDaemonSets()},handleCurrentChange(e){this.currentPage=e,this.getDaemonSets()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let a=new Date(new Date(e).getTime()+288e5);return a=a.toJSON(),a=a.substring(0,19).replace("T"," "),a},restartTotal(e){let a,t=0,n=e.row.status.containerStatuses;for(a in n)t+=n[a].restartCount;return t},getNamespaces(){(0,y.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getDaemonSets(){this.appLoading=!0,this.getDaemonSetsData.params.filter_name=this.searchInput,this.getDaemonSetsData.params.namespace=this.namespaceValue,this.getDaemonSetsData.params.page=this.currentPage,this.getDaemonSetsData.params.limit=this.pagesize,W(this.getDaemonSetsData.params).then((e=>{this.daemonSetList=e.data.items,this.daemonSetTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getDaemonSetDetail(e){this.getDaemonSetDetailData.params.name=e.row.metadata.name,this.getDaemonSetDetailData.params.namespace=this.namespaceValue,C(this.getDaemonSetDetailData.params).then((e=>{this.daemonSetDetail=e.data,this.contentYaml=this.transYaml(this.daemonSetDetail),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateDaemonSet(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateDaemonSetData.params.namespace=this.namespaceValue,this.updateDaemonSetData.params.content=e,k(this.updateDaemonSetData.params).then((e=>{this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},delDaemonSet(e){this.delDaemonSetData.params.daemonset_name=e.row.metadata.name,this.delDaemonSetData.params.namespace=this.namespaceValue,v(this.delDaemonSetData.params).then((e=>{this.getDaemonSets(),this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,a,t){this.confirmContent="确认继续 "+a+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{t(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getDaemonSets()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getDaemonSets()}},V=t(89);const x=(0,V.Z)(z,[["render",D],["__scopeId","data-v-bf904038"]]);var L=x}}]);
//# sourceMappingURL=858.38b3115d.js.map