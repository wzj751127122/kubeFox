"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[514],{3514:function(a,e,t){t.r(e),t.d(e,{default:function(){return S}});var n=t(3396),s=t(7139);const i=a=>((0,n.dD)("data-v-2e9b9459"),a=a(),(0,n.Cn)(),a),l={class:"configmap"},o=i((()=>(0,n._)("span",null,"命名空间: ",-1))),p=(0,n.Uk)("刷新"),r=(0,n.Uk)("创建"),m=(0,n.Uk)("搜索"),g={class:"configmap-body-configmapname"},u={style:{"overflow-y":"auto","max-height":"500px"}},c=(0,n.Uk)("YAML"),d=(0,n.Uk)("删除"),h={class:"dialog-footer"},f=(0,n.Uk)("取 消"),w=(0,n.Uk)("更 新");function C(a,e,t,i,C,_){const M=(0,n.up)("el-option"),y=(0,n.up)("el-select"),b=(0,n.up)("el-col"),D=(0,n.up)("el-button"),W=(0,n.up)("el-row"),k=(0,n.up)("el-card"),v=(0,n.up)("el-input"),z=(0,n.up)("el-table-column"),V=(0,n.up)("el-tag"),x=(0,n.up)("el-popover"),L=(0,n.up)("reading"),S=(0,n.up)("el-icon"),T=(0,n.up)("el-table"),U=(0,n.up)("el-pagination"),Y=(0,n.up)("codemirror"),I=(0,n.up)("el-dialog"),$=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(k,{class:"configmap-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[o,(0,n.Wm)(y,{modelValue:C.namespaceValue,"onUpdate:modelValue":e[0]||(e[0]=a=>C.namespaceValue=a),filterable:"",placeholder:"请选择"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(C.namespaceList,((a,e)=>((0,n.wg)(),(0,n.j4)(M,{key:e,label:a.metadata.name,value:a.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,n.Wm)(b,{span:2,offset:16},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(D,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:e[1]||(e[1]=a=>_.getConfigMaps())},{default:(0,n.w5)((()=>[p])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(k,{class:"configmap-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{span:2},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(D,{disabled:"",style:{"border-radius":"2px"},icon:"Edit",type:"primary"},{default:(0,n.w5)((()=>[r])),_:1})])])),_:1}),(0,n.Wm)(b,{span:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(v,{class:"configmap-head-search",clearable:"",placeholder:"请输入",modelValue:C.searchInput,"onUpdate:modelValue":e[2]||(e[2]=a=>C.searchInput=a)},null,8,["modelValue"]),(0,n.Wm)(D,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:e[3]||(e[3]=a=>_.getConfigMaps())},{default:(0,n.w5)((()=>[m])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,n.Wm)(b,{span:24},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(k,{class:"configmap-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,n.w5)((()=>[(0,n.wy)(((0,n.wg)(),(0,n.j4)(T,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:C.configMapList},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{width:"20"}),(0,n.Wm)(z,{align:"left",label:"ConfigMap名"},{default:(0,n.w5)((a=>[(0,n._)("a",g,(0,s.zw)(a.row.metadata.name),1)])),_:1}),(0,n.Wm)(z,{align:"center",label:"标签"},{default:(0,n.w5)((a=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.row.metadata.labels,((a,e)=>((0,n.wg)(),(0,n.iD)("div",{key:e},[(0,n.Wm)(x,{placement:"right",width:200,trigger:"hover",content:e+":"+a},{reference:(0,n.w5)((()=>[(0,n.Wm)(V,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(_.ellipsis(e+":"+a)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,n.Wm)(z,{align:"center",label:"DATA"},{default:(0,n.w5)((a=>[(0,n.Wm)(x,{style:{overflow:"auto"},placement:"right",width:400,trigger:"click"},{reference:(0,n.w5)((()=>[(0,n.Wm)(S,{style:{"font-size":"18px",cursor:"pointer"}},{default:(0,n.w5)((()=>[(0,n.Wm)(L)])),_:1})])),default:(0,n.w5)((()=>[(0,n._)("div",u,[(0,n._)("span",null,(0,s.zw)(a.row.data),1)])])),_:2},1024)])),_:1}),(0,n.Wm)(z,{align:"center","min-width":"100",label:"创建时间"},{default:(0,n.w5)((a=>[(0,n.Wm)(V,{type:"info"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(_.timeTrans(a.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,n.Wm)(z,{align:"center",label:"操作",width:"200"},{default:(0,n.w5)((a=>[(0,n.Wm)(D,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:e=>_.getConfigMapDetail(a)},{default:(0,n.w5)((()=>[c])),_:2},1032,["onClick"]),(0,n.Wm)(D,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:e=>_.handleConfirm(a,"删除",_.delConfigMap)},{default:(0,n.w5)((()=>[d])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[$,C.appLoading]]),(0,n.Wm)(U,{class:"configmap-body-pagination",background:"",onSizeChange:_.handleSizeChange,onCurrentChange:_.handleCurrentChange,"current-page":C.currentPage,"page-sizes":C.pagesizeList,"page-size":C.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:C.configMapTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,n.Wm)(I,{title:"YAML信息",modelValue:C.yamlDialog,"onUpdate:modelValue":e[6]||(e[6]=a=>C.yamlDialog=a),width:"45%",top:"5%"},{footer:(0,n.w5)((()=>[(0,n._)("span",h,[(0,n.Wm)(D,{onClick:e[4]||(e[4]=a=>C.yamlDialog=!1)},{default:(0,n.w5)((()=>[f])),_:1}),(0,n.Wm)(D,{type:"primary",onClick:e[5]||(e[5]=a=>_.updateConfigMap())},{default:(0,n.w5)((()=>[w])),_:1})])])),default:(0,n.w5)((()=>[(0,n.Wm)(Y,{value:C.contentYaml,border:"",options:C.cmOptions,height:"500",style:{"font-size":"14px"},onChange:_.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"])])}var _=t(7973),M=t(5959),y=t(1391),b=t(3794),D=t(4471);function W(a){return(0,D.Z)({url:"/api/k8s/configmap/list",method:"get",params:a})}function k(a){return(0,D.Z)({url:"/api/k8s/configmap/detail",method:"get",params:a})}function v(a){return(0,D.Z)({url:"/api/k8s/configmap/update",method:"put",params:a})}function z(a){return(0,D.Z)({url:"/api/k8s/configmap/del",method:"delete",params:a})}var V={data(){return{cmOptions:_.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,configMapList:[],configMapTotal:0,getConfigMapsData:{params:{filter_name:"",namespace:"",page:"",limit:""}},configMapDetail:{},getConfigMapDetailData:{params:{name:"",namespace:""}},yamlDialog:!1,updateConfigMapData:{params:{namespace:"",content:""}},delConfigMapData:{params:{name:"",namespace:""}}}},methods:{transYaml(a){return y.stringify(a)},transObj(a){return M.ZP.load(a)},onChange(a){this.contentYaml=a},handleSizeChange(a){this.pagesize=a,this.getConfigMaps()},handleCurrentChange(a){this.currentPage=a,this.getConfigMaps()},handleClose(a){this.$confirm("确认关闭？").then((()=>{a()})).catch((()=>{}))},ellipsis(a){return a.length>15?a.substring(0,15)+"...":a},timeTrans(a){let e=new Date(new Date(a).getTime()+288e5);return e=e.toJSON(),e=e.substring(0,19).replace("T"," "),e},restartTotal(a){let e,t=0,n=a.row.status.containerStatuses;for(e in n)t+=n[e].restartCount;return t},getNamespaces(){(0,b.I1)().then((a=>{this.namespaceList=a.data.items})).catch((a=>{this.$message.error({message:a.msg})}))},getConfigMaps(){this.appLoading=!0,this.getConfigMapsData.params.filter_name=this.searchInput,this.getConfigMapsData.params.namespace=this.namespaceValue,this.getConfigMapsData.params.page=this.currentPage,this.getConfigMapsData.params.limit=this.pagesize,W(this.getConfigMapsData.params).then((a=>{this.configMapList=a.data.items,this.configMapTotal=a.data.total})).catch((a=>{this.$message.error({message:a.msg})})),this.appLoading=!1},getConfigMapDetail(a){this.getConfigMapDetailData.params.name=a.row.metadata.name,this.getConfigMapDetailData.params.namespace=this.namespaceValue,k(this.getConfigMapDetailData.params).then((a=>{this.configMapDetail=a.data,this.contentYaml=this.transYaml(this.configMapDetail),this.yamlDialog=!0})).catch((a=>{this.$message.error({message:a.msg})}))},updateConfigMap(){let a=JSON.stringify(this.transObj(this.contentYaml));this.updateConfigMapData.params.namespace=this.namespaceValue,this.updateConfigMapData.params.content=a,v(this.updateConfigMapData.params).then((a=>{this.$message.success({message:a.msg})})).catch((a=>{this.$message.error({message:a.msg})})),this.yamlDialog=!1},delConfigMap(a){this.delConfigMapData.params.configmap_name=a.row.metadata.name,this.delConfigMapData.params.namespace=this.namespaceValue,z(this.delConfigMapData.params).then((a=>{this.getConfigMaps(),this.$message.success({message:a.msg})})).catch((a=>{this.$message.error({message:a.msg})}))},handleConfirm(a,e,t){this.confirmContent="确认继续 "+e+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{t(a)})).catch((()=>{this.$message.info({message:"已取消操作"})}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getConfigMaps()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getConfigMaps()}},x=t(89);const L=(0,x.Z)(V,[["render",C],["__scopeId","data-v-2e9b9459"]]);var S=L}}]);
//# sourceMappingURL=514.21814571.js.map