"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[512],{9512:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});var r=t(3396),l=t(7139);const s=e=>((0,r.dD)("data-v-725ec4e2"),e=e(),(0,r.Cn)(),e),i={class:"service"},n=s((()=>(0,r._)("span",null,"命名空间: ",-1))),c=(0,r.Uk)("刷新"),o=(0,r.Uk)("创建"),m=(0,r.Uk)("搜索"),p={class:"service-body-servicename"},d={style:{"font-weight":"bold"}},u={key:0},g={key:1},h=(0,r.Uk)("YAML"),v=(0,r.Uk)("删除"),w={class:"dialog-footer"},f=(0,r.Uk)("取 消"),S=(0,r.Uk)("更 新"),_=s((()=>(0,r._)("h4",null,"创建Service",-1))),b=(0,r.Uk)("取消"),y=(0,r.Uk)("立即创建");function D(e,a,t,s,D,W){const k=(0,r.up)("el-option"),V=(0,r.up)("el-select"),C=(0,r.up)("el-col"),z=(0,r.up)("el-button"),U=(0,r.up)("el-row"),L=(0,r.up)("el-card"),I=(0,r.up)("el-input"),P=(0,r.up)("el-table-column"),x=(0,r.up)("el-tag"),$=(0,r.up)("el-popover"),T=(0,r.up)("el-table"),Y=(0,r.up)("el-pagination"),j=(0,r.up)("codemirror"),N=(0,r.up)("el-dialog"),Z=(0,r.up)("el-form-item"),q=(0,r.up)("el-form"),E=(0,r.up)("el-drawer"),F=(0,r.Q2)("loading");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(U,null,{default:(0,r.w5)((()=>[(0,r.Wm)(C,{span:24},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(L,{class:"service-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(U,null,{default:(0,r.w5)((()=>[(0,r.Wm)(C,{span:6},{default:(0,r.w5)((()=>[(0,r._)("div",null,[n,(0,r.Wm)(V,{modelValue:D.namespaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>D.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(D.namespaceList,((e,a)=>((0,r.wg)(),(0,r.j4)(k,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,r.Wm)(C,{span:2,offset:16},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(z,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:a[1]||(a[1]=e=>W.getServices())},{default:(0,r.w5)((()=>[c])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,r.Wm)(C,{span:24},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(L,{class:"service-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(U,null,{default:(0,r.w5)((()=>[(0,r.Wm)(C,{span:2},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.wy)(((0,r.wg)(),(0,r.j4)(z,{style:{"border-radius":"2px"},icon:"Edit",type:"primary",onClick:a[2]||(a[2]=e=>D.createServiceDrawer=!0)},{default:(0,r.w5)((()=>[o])),_:1})),[[F,D.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])])])),_:1}),(0,r.Wm)(C,{span:6},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(I,{class:"service-head-search",clearable:"",placeholder:"请输入",modelValue:D.searchInput,"onUpdate:modelValue":a[3]||(a[3]=e=>D.searchInput=e)},null,8,["modelValue"]),(0,r.Wm)(z,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:a[4]||(a[4]=e=>W.getServices())},{default:(0,r.w5)((()=>[m])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,r.Wm)(C,{span:24},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(L,{class:"service-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,r.w5)((()=>[(0,r.wy)(((0,r.wg)(),(0,r.j4)(T,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:D.serviceList},{default:(0,r.w5)((()=>[(0,r.Wm)(P,{width:"20"}),(0,r.Wm)(P,{align:"left",label:"Service名"},{default:(0,r.w5)((e=>[(0,r._)("a",p,(0,l.zw)(e.row.metadata.name),1)])),_:1}),(0,r.Wm)(P,{align:"center",label:"标签","min-width":"120"},{default:(0,r.w5)((e=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.row.metadata.labels,((e,a)=>((0,r.wg)(),(0,r.iD)("div",{key:a},[(0,r.Wm)($,{placement:"right",width:200,trigger:"hover",content:a+":"+e},{reference:(0,r.w5)((()=>[(0,r.Wm)(x,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,l.zw)(W.ellipsis(a+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,r.Wm)(P,{align:"center",label:"类型"},{default:(0,r.w5)((e=>[(0,r._)("span",d,(0,l.zw)(e.row.spec.type),1)])),_:1}),(0,r.Wm)(P,{align:"center",label:"CLUSTER-IP"},{default:(0,r.w5)((e=>[(0,r._)("span",null,(0,l.zw)(e.row.spec.clusterIP),1)])),_:1}),(0,r.Wm)(P,{align:"center",label:"EXTERNAL-IP"},{default:(0,r.w5)((e=>[(0,r._)("span",null,(0,l.zw)(e.row.status.loadBalancer.ingress?e.row.status.loadBalancer.ingress[0].ip:""),1)])),_:1}),(0,r.Wm)(P,{align:"center",label:"端口"},{default:(0,r.w5)((e=>[e.row.spec.ports[0].nodePort?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("span",u,(0,l.zw)(e.row.spec.ports[0].port)+"/"+(0,l.zw)(e.row.spec.ports[0].protocol),1)),e.row.spec.ports[0].nodePort?((0,r.wg)(),(0,r.iD)("span",g,(0,l.zw)(e.row.spec.ports[0].port)+":"+(0,l.zw)(e.row.spec.ports[0].nodePort)+"/"+(0,l.zw)(e.row.spec.ports[0].protocol),1)):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(P,{align:"center","min-width":"100",label:"创建时间"},{default:(0,r.w5)((e=>[(0,r.Wm)(x,{type:"info"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,l.zw)(W.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,r.Wm)(P,{align:"center",label:"操作",width:"200"},{default:(0,r.w5)((e=>[(0,r.Wm)(z,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:a=>W.getServiceDetail(e)},{default:(0,r.w5)((()=>[h])),_:2},1032,["onClick"]),(0,r.Wm)(z,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:a=>W.handleConfirm(e,"删除",W.delService)},{default:(0,r.w5)((()=>[v])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[F,D.appLoading]]),(0,r.Wm)(Y,{class:"service-body-pagination",background:"",onSizeChange:W.handleSizeChange,onCurrentChange:W.handleCurrentChange,"current-page":D.currentPage,"page-sizes":D.pagesizeList,"page-size":D.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:D.serviceTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,r.Wm)(N,{title:"YAML信息",modelValue:D.yamlDialog,"onUpdate:modelValue":a[7]||(a[7]=e=>D.yamlDialog=e),width:"45%",top:"5%"},{footer:(0,r.w5)((()=>[(0,r._)("span",w,[(0,r.Wm)(z,{onClick:a[5]||(a[5]=e=>D.yamlDialog=!1)},{default:(0,r.w5)((()=>[f])),_:1}),(0,r.Wm)(z,{type:"primary",onClick:a[6]||(a[6]=e=>W.updateService())},{default:(0,r.w5)((()=>[S])),_:1})])])),default:(0,r.w5)((()=>[(0,r.Wm)(j,{value:D.contentYaml,border:"",options:D.cmOptions,height:"500",style:{"font-size":"14px"},onChange:W.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"]),(0,r.Wm)(E,{modelValue:D.createServiceDrawer,"onUpdate:modelValue":a[17]||(a[17]=e=>D.createServiceDrawer=e),direction:D.direction,"before-close":W.handleClose},{title:(0,r.w5)((()=>[_])),default:(0,r.w5)((()=>[(0,r.Wm)(U,{type:"flex",justify:"center"},{default:(0,r.w5)((()=>[(0,r.Wm)(C,{span:20},{default:(0,r.w5)((()=>[(0,r.Wm)(q,{ref:"createService",rules:D.createServiceRules,model:D.createService,"label-width":"80px"},{default:(0,r.w5)((()=>[(0,r.Wm)(Z,{class:"service-create-form",label:"名称",prop:"name"},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{modelValue:D.createService.name,"onUpdate:modelValue":a[8]||(a[8]=e=>D.createService.name=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(Z,{class:"service-create-form",label:"命名空间",prop:"namespace"},{default:(0,r.w5)((()=>[(0,r.Wm)(V,{modelValue:D.createService.namespace,"onUpdate:modelValue":a[9]||(a[9]=e=>D.createService.namespace=e),filterable:"",placeholder:"请选择"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(D.namespaceList,((e,a)=>((0,r.wg)(),(0,r.j4)(k,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(Z,{class:"service-create-form",label:"类型",prop:"type"},{default:(0,r.w5)((()=>[(0,r.Wm)(V,{modelValue:D.createService.type,"onUpdate:modelValue":a[10]||(a[10]=e=>D.createService.type=e),placeholder:"请选择"},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{value:"ClusterIP",label:"ClusterIP"}),(0,r.Wm)(k,{value:"NodePort",label:"NodePort"})])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(Z,{class:"deploy-create-form",label:"容器端口",prop:"container_port"},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{modelValue:D.createService.container_port,"onUpdate:modelValue":a[11]||(a[11]=e=>D.createService.container_port=e),placeholder:"示例: 80"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(Z,{class:"service-create-form",label:"Service端口",prop:"port"},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{modelValue:D.createService.port,"onUpdate:modelValue":a[12]||(a[12]=e=>D.createService.port=e),placeholder:"示例: 80"},null,8,["modelValue"])])),_:1}),"NodePort"==D.createService.type?((0,r.wg)(),(0,r.j4)(Z,{key:0,class:"service-create-form",label:"NodePort",prop:"node_port"},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{modelValue:D.createService.node_port,"onUpdate:modelValue":a[13]||(a[13]=e=>D.createService.node_port=e),placeholder:"示例: 30001"},null,8,["modelValue"])])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(Z,{class:"SERVICE-create-form",label:"标签",prop:"label_str"},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{modelValue:D.createService.label_str,"onUpdate:modelValue":a[14]||(a[14]=e=>D.createService.label_str=e),placeholder:"示例: project=ms,app=gateway"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1})])),_:1})])),footer:(0,r.w5)((()=>[(0,r.Wm)(z,{onClick:a[15]||(a[15]=e=>D.createServiceDrawer=!1)},{default:(0,r.w5)((()=>[b])),_:1}),(0,r.Wm)(z,{type:"primary",onClick:a[16]||(a[16]=e=>W.submitForm("createService"))},{default:(0,r.w5)((()=>[y])),_:1})])),_:1},8,["modelValue","direction","before-close"])])}var W=t(7973),k=t(4471),V=t(5959),C=t(1391),z=t(3794);function U(e){return(0,k.Z)({url:"/api/k8s/service/list",method:"get",params:e})}function L(e){return(0,k.Z)({url:"/api/k8s/service/detail",method:"get",params:e})}function I(e){return(0,k.Z)({url:"/api/k8s/service/update",method:"put",params:e})}function P(e){return(0,k.Z)({url:"/api/k8s/service/del",method:"delete",params:e})}function x(e){return(0,k.Z)({url:"/api/k8s/service/create",method:"post",data:e})}var $={data(){return{cmOptions:W.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,serviceList:[],serviceTotal:0,getServicesData:{params:{filter_name:"",namespace:"",page:"",limit:""}},serviceDetail:{},getServiceDetailData:{params:{name:"",namespace:""}},yamlDialog:!1,updateServiceData:{params:{namespace:"",content:""}},delServiceData:{params:{name:"",namespace:""}},fullscreenLoading:!1,direction:"rtl",createServiceDrawer:!1,createService:{name:"",namespace:"",type:"ClusterIP",container_port:"",port:"",node_port:"",label:{},label_str:""},createServiceData:{params:{}},createServiceRules:{name:[{required:!0,message:"请填写名称",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],port:[{required:!0,message:"请填写Service端口",trigger:"change"}],node_port:[{required:!0,message:"请填写NodePort",trigger:"change"}],label_str:[{required:!0,message:"请填写标签",trigger:"change"}],container_port:[{required:!0,message:"请填写容器端口",trigger:"change"}]}}},methods:{transYaml(e){return C.stringify(e)},transObj(e){return V.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getServices()},handleCurrentChange(e){this.currentPage=e,this.getServices()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let a=new Date(new Date(e).getTime()+288e5);return a=a.toJSON(),a=a.substring(0,19).replace("T"," "),a},restartTotal(e){let a,t=0,r=e.row.status.containerStatuses;for(a in r)t+=r[a].restartCount;return t},getNamespaces(){(0,z.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getServices(){this.appLoading=!0,this.getServicesData.params.filter_name=this.searchInput,this.getServicesData.params.namespace=this.namespaceValue,this.getServicesData.params.page=this.currentPage,this.getServicesData.params.limit=this.pagesize,U(this.getServicesData.params).then((e=>{this.serviceList=e.data.items,this.serviceTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getServiceDetail(e){this.getServiceDetailData.params.name=e.row.metadata.name,this.getServiceDetailData.params.namespace=this.namespaceValue,L(this.getServiceDetailData.params).then((e=>{this.serviceDetail=e.data,this.contentYaml=this.transYaml(this.serviceDetail),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateService(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateServiceData.params.namespace=this.namespaceValue,this.updateServiceData.params.content=e,I(this.updateServiceData.params).then((e=>{this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},delService(e){this.delServiceData.params.name=e.row.metadata.name,this.delServiceData.params.namespace=this.namespaceValue,P(this.delServiceData.params).then((e=>{this.getServices(),this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,a,t){this.confirmContent="确认继续 "+a+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{t(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))},createServiceFunc(){let e=new RegExp("(^[A-Za-z]+=[A-Za-z0-9]+).*");if(!e.test(this.createService.label_str))return void this.$message.warning({message:"标签填写异常，请确认后重新填写"});this.fullscreenLoading=!0;let a=new Map,t=this.createService.label_str.split(",");t.forEach((e=>{let t=e.split("=");a[t[0]]=t[1]})),this.createServiceData.params=this.createService,this.createServiceData.params.label=a,this.createServiceData.params.container_port=parseInt(this.createService.container_port),this.createServiceData.params.port=parseInt(this.createService.port),this.createServiceData.params.node_port=parseInt(this.createService.node_port),x(this.createServiceData.params).then((e=>{this.$message.success({message:e.msg}),this.getServices()})).catch((e=>{this.$message.error({message:e.msg})})),this.resetForm("createService"),this.fullscreenLoading=!1,this.createServiceDrawer=!1},resetForm(e){this.$refs[e].resetFields()},submitForm(e){this.$refs[e].validate((e=>{if(!e)return!1;this.createServiceFunc()}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getServices()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getServices()}},T=t(89);const Y=(0,T.Z)($,[["render",D],["__scopeId","data-v-725ec4e2"]]);var j=Y}}]);
//# sourceMappingURL=512.77234343.js.map