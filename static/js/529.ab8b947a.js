"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[529],{2529:function(e,a,s){s.r(a),s.d(a,{default:function(){return Z}});var t=s(3396),r=s(7139);const l=e=>((0,t.dD)("data-v-eedb36da"),e=e(),(0,t.Cn)(),e),n={class:"ingress"},i=l((()=>(0,t._)("span",null,"命名空间: ",-1))),m=(0,t.Uk)("刷新"),g=(0,t.Uk)("创建"),o=(0,t.Uk)("搜索"),p={class:"ingress-body-ingressname"},c=(0,t.Uk)("YAML"),d=(0,t.Uk)("删除"),u={class:"dialog-footer"},h=(0,t.Uk)("取 消"),w=(0,t.Uk)("更 新"),f=l((()=>(0,t._)("h4",null,"创建Ingress",-1))),_=(0,t.Uk)("取消"),I=(0,t.Uk)("立即创建");function b(e,a,s,l,b,W){const y=(0,t.up)("el-option"),D=(0,t.up)("el-select"),v=(0,t.up)("el-col"),k=(0,t.up)("el-button"),V=(0,t.up)("el-row"),C=(0,t.up)("el-card"),z=(0,t.up)("el-input"),U=(0,t.up)("el-table-column"),x=(0,t.up)("el-tag"),L=(0,t.up)("el-popover"),S=(0,t.up)("el-table"),Y=(0,t.up)("el-pagination"),Z=(0,t.up)("codemirror"),$=(0,t.up)("el-dialog"),T=(0,t.up)("el-form-item"),E=(0,t.up)("el-form"),P=(0,t.up)("el-drawer"),j=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)("div",n,[(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{span:24},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(C,{class:"ingress-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{span:6},{default:(0,t.w5)((()=>[(0,t._)("div",null,[i,(0,t.Wm)(D,{modelValue:b.namespaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>b.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.namespaceList,((e,a)=>((0,t.wg)(),(0,t.j4)(y,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,t.Wm)(v,{span:2,offset:16},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(k,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:a[1]||(a[1]=e=>W.getIngresss())},{default:(0,t.w5)((()=>[m])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,t.Wm)(v,{span:24},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(C,{class:"ingress-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{span:2},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.wy)(((0,t.wg)(),(0,t.j4)(k,{style:{"border-radius":"2px"},icon:"Edit",type:"primary",onClick:a[2]||(a[2]=e=>b.createIngressDrawer=!0)},{default:(0,t.w5)((()=>[g])),_:1})),[[j,b.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])])])),_:1}),(0,t.Wm)(v,{span:6},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(z,{class:"ingress-head-search",clearable:"",placeholder:"请输入",modelValue:b.searchInput,"onUpdate:modelValue":a[3]||(a[3]=e=>b.searchInput=e)},null,8,["modelValue"]),(0,t.Wm)(k,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:a[4]||(a[4]=e=>W.getIngresss())},{default:(0,t.w5)((()=>[o])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,t.Wm)(v,{span:24},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(C,{class:"ingress-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,t.w5)((()=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(S,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:b.ingressList},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{width:"10"}),(0,t.Wm)(U,{align:"left",label:"Ingress名"},{default:(0,t.w5)((e=>[(0,t._)("a",p,(0,r.zw)(e.row.metadata.name),1)])),_:1}),(0,t.Wm)(U,{align:"center",label:"标签","min-width":"120"},{default:(0,t.w5)((e=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.metadata.labels,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t.Wm)(L,{placement:"right",width:200,trigger:"hover",content:a+":"+e},{reference:(0,t.w5)((()=>[(0,t.Wm)(x,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(W.ellipsis(a+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,t.Wm)(U,{align:"center",label:"Host","min-width":"120"},{default:(0,t.w5)((e=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.spec.rules,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t.Wm)(L,{placement:"right",width:200,trigger:"hover",content:e.host},{reference:(0,t.w5)((()=>[(0,t.Wm)(x,{style:{"margin-bottom":"5px"},type:"danger"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(W.ellipsis(e.host)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,t.Wm)(U,{align:"center",label:"Path"},{default:(0,t.w5)((e=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.spec.rules,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t.Wm)(L,{placement:"right",width:100,trigger:"hover",content:e.http.paths[0].path},{reference:(0,t.w5)((()=>[(0,t.Wm)(x,{style:{"margin-bottom":"5px"},type:"danger"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(e.http.paths[0].path),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,t.Wm)(U,{align:"center",label:"EXTERNAL-IP"},{default:(0,t.w5)((e=>[(0,t._)("span",null,(0,r.zw)(e.row.status.loadBalancer.ingress?e.row.status.loadBalancer.ingress[0].ip:""),1)])),_:1}),(0,t.Wm)(U,{align:"center",label:"TLS"},{default:(0,t.w5)((e=>[(0,t._)("span",null,(0,r.zw)(e.row.spec.tls?"YES":""),1)])),_:1}),(0,t.Wm)(U,{align:"center","min-width":"100",label:"创建时间"},{default:(0,t.w5)((e=>[(0,t.Wm)(x,{type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(W.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,t.Wm)(U,{align:"center",label:"操作",width:"200"},{default:(0,t.w5)((e=>[(0,t.Wm)(k,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:a=>W.getIngressDetail(e)},{default:(0,t.w5)((()=>[c])),_:2},1032,["onClick"]),(0,t.Wm)(k,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:a=>W.handleConfirm(e,"删除",W.delIngress)},{default:(0,t.w5)((()=>[d])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[j,b.appLoading]]),(0,t.Wm)(Y,{class:"ingress-body-pagination",background:"",onSizeChange:W.handleSizeChange,onCurrentChange:W.handleCurrentChange,"current-page":b.currentPage,"page-sizes":b.pagesizeList,"page-size":b.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:b.ingressTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,t.Wm)($,{title:"YAML信息",modelValue:b.yamlDialog,"onUpdate:modelValue":a[7]||(a[7]=e=>b.yamlDialog=e),width:"45%",top:"5%"},{footer:(0,t.w5)((()=>[(0,t._)("span",u,[(0,t.Wm)(k,{onClick:a[5]||(a[5]=e=>b.yamlDialog=!1)},{default:(0,t.w5)((()=>[h])),_:1}),(0,t.Wm)(k,{type:"primary",onClick:a[6]||(a[6]=e=>W.updateIngress())},{default:(0,t.w5)((()=>[w])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(Z,{value:b.contentYaml,border:"",options:b.cmOptions,height:"500",style:{"font-size":"14px"},onChange:W.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"]),(0,t.Wm)(P,{modelValue:b.createIngressDrawer,"onUpdate:modelValue":a[18]||(a[18]=e=>b.createIngressDrawer=e),direction:b.direction,"before-close":W.handleClose},{title:(0,t.w5)((()=>[f])),default:(0,t.w5)((()=>[(0,t.Wm)(V,{type:"flex",justify:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{span:20},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{ref:"createIngress",rules:b.createIngressRules,model:b.createIngress,"label-width":"80px"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{class:"ingress-create-form",label:"名称",prop:"name"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:b.createIngress.name,"onUpdate:modelValue":a[8]||(a[8]=e=>b.createIngress.name=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"ingress-create-form",label:"命名空间",prop:"namespace"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{modelValue:b.createIngress.namespace,"onUpdate:modelValue":a[9]||(a[9]=e=>b.createIngress.namespace=e),filterable:"",placeholder:"请选择"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.namespaceList,((e,a)=>((0,t.wg)(),(0,t.j4)(y,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"SERVICE-create-form",label:"标签",prop:"label_str"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:b.createIngress.label_str,"onUpdate:modelValue":a[10]||(a[10]=e=>b.createIngress.label_str=e),placeholder:"示例: project=ms,app=gateway"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"deploy-create-form",label:"域名",prop:"host"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:b.createIngress.host,"onUpdate:modelValue":a[11]||(a[11]=e=>b.createIngress.host=e),placeholder:"示例: www.example.com"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"ingress-create-form",label:"Path",prop:"path"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:b.createIngress.path,"onUpdate:modelValue":a[12]||(a[12]=e=>b.createIngress.path=e),placeholder:"示例: /abc"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"deploy-create-form",label:"匹配类型",prop:"path_type"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{modelValue:b.createIngress.path_type,"onUpdate:modelValue":a[13]||(a[13]=e=>b.createIngress.path_type=e),placeholder:"请选择"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{value:"Prefix",label:"Prefix"}),(0,t.Wm)(y,{value:"Exact",label:"Exact"}),(0,t.Wm)(y,{value:"ImplementationSpecific",label:"ImplementationSpecific"})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"ingress-create-form",label:"Service名",prop:"service_name"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{disabled:"",modelValue:b.createIngress.name,"onUpdate:modelValue":a[14]||(a[14]=e=>b.createIngress.name=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{class:"ingress-create-form",label:"Service端口",prop:"service_port"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:b.createIngress.service_port,"onUpdate:modelValue":a[15]||(a[15]=e=>b.createIngress.service_port=e),placeholder:"示例: 80"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1})])),_:1})])),footer:(0,t.w5)((()=>[(0,t.Wm)(k,{onClick:a[16]||(a[16]=e=>b.createIngressDrawer=!1)},{default:(0,t.w5)((()=>[_])),_:1}),(0,t.Wm)(k,{type:"primary",onClick:a[17]||(a[17]=e=>W.submitForm("createIngress"))},{default:(0,t.w5)((()=>[I])),_:1})])),_:1},8,["modelValue","direction","before-close"])])}var W=s(7973),y=s(5959),D=s(1391),v=s(3794),k=s(4471);function V(e){return(0,k.Z)({url:"/api/k8s/ingress/list",method:"get",params:e})}function C(e){return(0,k.Z)({url:"/api/k8s/ingress/detail",method:"get",params:e})}function z(e){return(0,k.Z)({url:"/api/k8s/ingress/update",method:"put",params:e})}function U(e){return(0,k.Z)({url:"/api/k8s/ingress/del",method:"delete",params:e})}function x(e){return(0,k.Z)({url:"/api/k8s/ingress/create",method:"post",data:e})}var L={data(){return{cmOptions:W.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],namespaceListUrl:W.Z.k8sNamespaceList,appLoading:!1,ingressList:[],ingressTotal:0,getIngresssData:{url:W.Z.k8sIngressList,params:{filter_name:"",namespace:"",page:"",limit:""}},ingressDetail:{},getIngressDetailData:{url:W.Z.k8sIngressDetail,params:{ingress_name:"",namespace:""}},yamlDialog:!1,updateIngressData:{url:W.Z.k8sIngressUpdate,params:{namespace:"",content:""}},delIngressData:{url:W.Z.k8sIngressDel,params:{ingress_name:"",namespace:""}},fullscreenLoading:!1,direction:"rtl",createIngressDrawer:!1,createIngress:{name:"",namespace:"",label_str:"",host:"",path:"",path_type:"",service_name:"",service_port:"",hosts:{}},createIngressData:{params:{}},createIngressRules:{name:[{required:!0,message:"请填写名称",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],host:[{required:!0,message:"请填写域名",trigger:"change"}],path:[{required:!0,message:"请填写路径",trigger:"change"}],service_port:[{required:!0,message:"请填写Service端口",trigger:"change"}],label_str:[{required:!0,message:"请填写标签",trigger:"change"}],path_type:[{required:!0,message:"请选择匹配类型",trigger:"change"}]}}},methods:{transYaml(e){return D.stringify(e)},transObj(e){return y.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getIngresss()},handleCurrentChange(e){this.currentPage=e,this.getIngresss()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let a=new Date(new Date(e).getTime()+288e5);return a=a.toJSON(),a=a.substring(0,19).replace("T"," "),a},restartTotal(e){let a,s=0,t=e.row.status.containerStatuses;for(a in t)s+=t[a].restartCount;return s},getNamespaces(){(0,v.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getIngresss(){this.appLoading=!0,this.getIngresssData.params.filter_name=this.searchInput,this.getIngresssData.params.namespace=this.namespaceValue,this.getIngresssData.params.page=this.currentPage,this.getIngresssData.params.limit=this.pagesize,V(this.getIngresssData.params).then((e=>{this.ingressList=e.data.items,this.ingressTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getIngressDetail(e){this.getIngressDetailData.params.ingress_name=e.row.metadata.name,this.getIngressDetailData.params.namespace=this.namespaceValue,C(this.getIngressDetailData.params).then((e=>{this.ingressDetail=e.data,this.contentYaml=this.transYaml(this.ingressDetail),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateIngress(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateIngressData.params.namespace=this.namespaceValue,this.updateIngressData.params.content=e,z(this.updateIngressData.params).then((e=>{this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},delIngress(e){this.delIngressData.params.ingress_name=e.row.metadata.name,this.delIngressData.params.namespace=this.namespaceValue,U(this.delIngressData.params).then((e=>{this.getIngresss(),this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,a,s){this.confirmContent="确认继续 "+a+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{s(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))},createIngressFunc(){let e=new RegExp("(^[A-Za-z]+=[A-Za-z0-9]+).*");if(!e.test(this.createIngress.label_str))return void this.$message.warning({message:"标签填写异常，请确认后重新填写"});this.fullscreenLoading=!0;let a=new Map,s=this.createIngress.label_str.split(",");s.forEach((e=>{let s=e.split("=");a[s[0]]=s[1]}));let t=new Map,r=[],l={path:this.createIngress.path,path_type:this.createIngress.path_type,service_name:this.createIngress.name,service_port:parseInt(this.createIngress.service_port)};r.push(l),t[this.createIngress.host]=r,this.createIngressData.params=this.createIngress,this.createIngressData.params.label=a,this.createIngressData.params.hosts=t,x(this.createIngressData.params).then((e=>{this.$message.success({message:e.msg}),this.getIngresss()})).catch((e=>{this.$message.error({message:e.msg})})),this.resetForm("createIngress"),this.fullscreenLoading=!1,this.createIngressDrawer=!1},resetForm(e){this.$refs[e].resetFields()},submitForm(e){this.$refs[e].validate((e=>{if(!e)return!1;this.createIngressFunc()}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getIngresss()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getIngresss()}},S=s(89);const Y=(0,S.Z)(L,[["render",b],["__scopeId","data-v-eedb36da"]]);var Z=Y}}]);
//# sourceMappingURL=529.ab8b947a.js.map