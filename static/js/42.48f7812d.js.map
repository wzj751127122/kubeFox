{"version":3,"file":"js/42.48f7812d.js","mappings":"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","sources":["webpack://kube-manage-web/./src/api/operatorAudit.js","webpack://kube-manage-web/./src/utils/date.js","webpack://kube-manage-web/./src/utils/format.js","webpack://kube-manage-web/./src/views/audit/AuditView.vue","webpack://kube-manage-web/./src/views/audit/AuditView.vue?3cab"],"sourcesContent":["import request from \"@/utils/request\";\n\n\n\n// export function getSysOperationRecordList (query) {\n//     console.log(\"Sending request to /api/operation/get_operations with query:\", query);\n//     return request({\n//         url: \"/api/operation/get_operations\",\n//         method: \"get\",\n//         params: query,\n//     }).then(response => {\n//         console.log(\"Received response:\", response);\n//         return response;\n//     });\n// }\nexport function getSysOperationRecordList(query){\n    return request({\n        url: \"/api/operation/get_operations\",\n        method: \"get\",\n        params: query,\n    });\n}\n\nexport function deleteSysOperationRecord (id) {\n    return request({\n        url: `/api/operation/${id}/delete_operation`,\n        method: \"delete\",\n    });\n}\n\nexport function deleteSysOperationRecordByIds (data) {\n    return request({\n        url: \"/api/operation/delete_operations\",\n        method: \"post\",\n        data,\n    });\n}\n","// 对Date的扩展，将 Date 转化为指定格式的String\n// 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，\n// 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)\n// (new Date()).Format(\"yyyy-MM-dd hh:mm:ss.S\") ==> 2006-07-02 08:09:04.423\n// (new Date()).Format(\"yyyy-M-d h:m:s.S\")      ==> 2006-7-2 8:9:4.18\n// eslint-disable-next-line no-extend-native\nDate.prototype.Format = function (fmt) {\n    var o = {\n      \"M+\": this.getMonth() + 1, // 月份\n      \"d+\": this.getDate(), // 日\n      \"h+\": this.getHours(), // 小时\n      \"m+\": this.getMinutes(), // 分\n      \"s+\": this.getSeconds(), // 秒\n      \"q+\": Math.floor((this.getMonth() + 3) / 3), // 季度\n      S: this.getMilliseconds(), // 毫秒\n    };\n    if (/(y+)/.test(fmt)) {\n      fmt = fmt.replace(\n        RegExp.$1,\n        (this.getFullYear() + \"\").substr(4 - RegExp.$1.length)\n      );\n    }\n    for (var k in o) {\n      if (new RegExp(\"(\" + k + \")\").test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          RegExp.$1.length === 1 ? o[k] : (\"00\" + o[k]).substr((\"\" + o[k]).length)\n        );\n      }\n    }\n    return fmt;\n  };\n  \n  export function formatTimeToStr(times, pattern) {\n    var d = new Date(times).Format(\"yyyy-MM-dd hh:mm:ss\");\n    if (pattern) {\n      d = new Date(times).Format(pattern);\n    }\n    return d.toLocaleString();\n  }\n  ","import { formatTimeToStr } from \"@/utils/date\";\n\nexport const formatBoolean = (bool) => {\n  if (bool !== null) {\n    return bool ? \"是\" : \"否\";\n  } else {\n    return \"\";\n  }\n};\nexport const formatDate = (time) => {\n  if (time !== null && time !== \"\") {\n    var date = new Date(time);\n    return formatTimeToStr(date, \"yyyy-MM-dd hh:mm:ss\");\n  } else {\n    return \"\";\n  }\n};\n\nexport const filterDict = (value, options) => {\n  const rowLabel = options && options.filter((item) => item.value === value);\n  return rowLabel && rowLabel[0] && rowLabel[0].label;\n};\n","<template>\n    <div>\n        <div class=\"gva-search-box\">\n            <el-card>\n                <el-form :inline=\"true\" :model=\"searchInfo\">\n                    <el-form-item label=\"请求方法\">\n                        <el-select v-model=\"searchInfo.method\" placeholder=\"请输入请求方法\">\n                            <el-option v-for=\"(item, index) in method\" :key=\"index\" :label=\"item\" :value=\"item\" />\n                        </el-select>\n                    </el-form-item>\n                    <el-form-item label=\"请求路径\">\n                        <el-input v-model=\"searchInfo.path\" placeholder=\"搜索条件\" />\n                    </el-form-item>\n                    <el-form-item label=\"结果状态码\">\n                        <el-input v-model=\"searchInfo.status\" placeholder=\"搜索条件\" />\n                    </el-form-item>\n                    <el-form-item>\n                        <el-button size=\"small\" type=\"primary\" icon=\"search\" @click=\"onSubmit\">查询</el-button>\n                        <el-button size=\"small\" icon=\"refresh\" @click=\"onReset\">重置</el-button>\n                    </el-form-item>\n                </el-form>\n            </el-card>\n        </div>\n        <div class=\"gva-table-box mt-2\">\n            <el-card>\n                <div>\n                    <el-popover v-model=\"deleteVisible\" placement=\"top\" width=\"160\">\n                        <p>确定要删除吗？</p>\n                        <div style=\"text-align: right; margin-top: 8px\">\n                            <el-button size=\"small\" type=\"primary\" link @click=\"deleteVisible = false\">取消</el-button>\n                            <el-button size=\"small\" type=\"primary\" @click=\"onDelete\">确定</el-button>\n                        </div>\n                        <template #reference>\n                            <el-button icon=\"delete\" size=\"small\" style=\"margin-left: 10px\"\n                                :disabled=\"!multipleSelection.length\" @click=\"deleteVisible = true\">删除</el-button>\n                        </template>\n                    </el-popover>\n                </div>\n                <el-table v-loading=\"loading\" ref=\"multipleTable\" :data=\"tableData\" style=\"width: 100%\"\n                    tooltip-effect=\"dark\" row-key=\"id\" @selection-change=\"handleSelectionChange\">\n                    <el-table-column align=\"left\" type=\"selection\" width=\"55\" />\n                    <el-table-column align=\"center\" label=\"操作人\" width=\"200\">\n                        <template #default=\"scope\">\n                            <div>\n                                {{ scope.row.user.userName }}({{ scope.row.user.nickName }})\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"center\" label=\"创建时间\" width=\"180\">\n                        <template #default=\"scope\">{{\n                            formatDate(scope.row.created_at)\n                        }}</template>\n                    </el-table-column>\n                    <el-table-column align=\"center\" label=\"状态码\" prop=\"status\" width=\"120\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-tag type=\"success\">{{ scope.row.status }}</el-tag>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"请求IP\" prop=\"ip\" width=\"120\" />\n                    <el-table-column align=\"center\" label=\"请求方法\" prop=\"method\" width=\"120\" />\n                    <el-table-column align=\"center\" label=\"请求路径\" prop=\"path\" width=\"500\" />\n                    <el-table-column align=\"left\" label=\"请求\" prop=\"path\" width=\"80\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-popover v-if=\"scope.row.body\" placement=\"left-start\" trigger=\"click\">\n                                    <div class=\"popover-box\">\n                                        <pre>{{ fmtBody(scope.row.body) }}</pre>\n                                    </div>\n                                    <template #reference>\n                                        <el-icon style=\"cursor: pointer\">\n                                            <warning />\n                                        </el-icon>\n                                    </template>\n                                </el-popover>\n\n                                <span v-else>无</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"响应\" prop=\"path\" width=\"80\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-popover v-if=\"scope.row.resp\" placement=\"left-start\" trigger=\"click\">\n                                    <div class=\"popover-box\">\n                                        <pre>{{ fmtBody(scope.row.resp) }}</pre>\n                                    </div>\n                                    <template #reference>\n                                        <el-icon style=\"cursor: pointer\">\n                                            <warning />\n                                        </el-icon>\n                                    </template>\n                                </el-popover>\n                                <span v-else>无</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"操作\">\n                        <template #default=\"scope\">\n                            <el-popover v-model=\"scope.row.visible\" placement=\"top\" width=\"160\">\n                                <p>确定要删除吗？</p>\n                                <div style=\"text-align: right; margin-top: 8px\">\n                                    <el-button size=\"small\" type=\"primary\" link\n                                        @click=\"scope.row.visible = false\">取消</el-button>\n                                    <el-button size=\"small\" type=\"primary\"\n                                        @click=\"deleteSysOperationRecordFunc(scope.row)\">确定</el-button>\n                                </div>\n                                <template #reference>\n                                    <el-button icon=\"delete\" size=\"small\" type=\"primary\" link\n                                        @click=\"scope.row.visible = true\">删除</el-button>\n                                </template>\n                            </el-popover>\n                        </template>\n                    </el-table-column>\n                </el-table>\n                <div class=\"gva-pagination mt-2\">\n                    <el-pagination :current-page=\"page\" :page-size=\"pageSize\" :page-sizes=\"[10, 30, 50, 100]\" :total=\"total\"\n                        layout=\"total, sizes, prev, pager, next, jumper\" @current-change=\"handleCurrentChange\"\n                        @size-change=\"handleSizeChange\" />\n                </div>\n            </el-card>\n        </div>\n    </div>\n</template>\n  \n<script setup>\nimport {\n    deleteSysOperationRecord,\n    getSysOperationRecordList,\n    deleteSysOperationRecordByIds,\n} from \"@/api/operatorAudit\";\nimport { formatDate } from \"@/utils/format\";\nimport { ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\n\nconst loading = ref(true);\nconst page = ref(1);\nconst total = ref(0);\nconst pageSize = ref(10);\nconst tableData = ref([]);\nconst searchInfo = ref({});\nconst method = ref([\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]);\nconst onReset = () => {\n    searchInfo.value = {};\n    getTableData();\n};\n// 条件搜索前端看此方法\nconst onSubmit = () => {\n    page.value = 1;\n    pageSize.value = 10;\n    if (searchInfo.value.status === \"\") {\n        searchInfo.value.status = null;\n    }\n    // console.log(\"Sending query to getSysOperationRecordList:\", searchInfo.value);\n    getTableData();\n};\n\n// 分页\nconst handleSizeChange = (val) => {\n    pageSize.value = val;\n    getTableData();\n};\n\nconst handleCurrentChange = (val) => {\n    page.value = val;\n    getTableData();\n};\n\n// 查询\nconst getTableData = async () => {\n    loading.value = true;\n    const table = await getSysOperationRecordList({\n        page: page.value,\n        pageSize: pageSize.value,\n        ...searchInfo.value,\n    });\n    if (table) {\n        tableData.value = table.data.list;\n        total.value = table.data.total;\n        page.value = table.data.page;\n        pageSize.value = table.data.pageSize;\n        loading.value = false;\n    }\n};\n\ngetTableData();\n\nconst deleteVisible = ref(false);\nconst multipleSelection = ref([]);\nconst handleSelectionChange = (val) => {\n    multipleSelection.value = val;\n};\nconst onDelete = async () => {\n    const ids = [];\n    multipleSelection.value &&\n        multipleSelection.value.forEach((item) => {\n            ids.push(item.id);\n        });\n    const res = await deleteSysOperationRecordByIds({ ids });\n    if (res) {\n        ElMessage({\n            type: \"success\",\n            message: \"删除成功\",\n        });\n        if (tableData.value.length === ids.length && page.value > 1) {\n            page.value--;\n        }\n        deleteVisible.value = false;\n        getTableData();\n    }\n};\nconst deleteSysOperationRecordFunc = async (row) => {\n    row.visible = false;\n    const res = await deleteSysOperationRecord(row.id);\n    if (res) {\n        ElMessage({\n            type: \"success\",\n            message: \"删除成功\",\n        });\n        if (tableData.value.length === 1 && page.value > 1) {\n            page.value--;\n        }\n        getTableData();\n    }\n};\nconst fmtBody = (value) => {\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n};\n</script>\n  \n<script>\nexport default {\n    name: \"SysOperationRecord\",\n};\n</script>\n  \n<style lang=\"scss\">\n.table-expand {\n    padding-left: 60px;\n    font-size: 0;\n\n    label {\n        width: 90px;\n        color: #99a9bf;\n\n        .el-form-item {\n            margin-right: 0;\n            margin-bottom: 0;\n            width: 50%;\n        }\n    }\n}\n\n.popover-box {\n    background: #112435;\n    color: #f08047;\n    height: 600px;\n    width: 420px;\n    overflow: auto;\n}\n\n.popover-box::-webkit-scrollbar {\n    display: none;\n    /* Chrome Safari */\n}\n</style>\n  ","import script from \"./AuditView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./AuditView.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./AuditView.vue?vue&type=style&index=0&id=7ced036a&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["getSysOperationRecordList","query","request","url","method","params","deleteSysOperationRecord","id","deleteSysOperationRecordByIds","data","formatTimeToStr","times","pattern","d","Date","Format","toLocaleString","prototype","fmt","o","this","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","length","formatDate","time","date","name","loading","ref","page","total","pageSize","tableData","searchInfo","onReset","value","getTableData","onSubmit","status","handleSizeChange","val","handleCurrentChange","async","table","list","deleteVisible","multipleSelection","handleSelectionChange","onDelete","ids","forEach","item","push","res","ElMessage","type","message","deleteSysOperationRecordFunc","row","visible","fmtBody","JSON","parse","err","__exports__"],"sourceRoot":""}