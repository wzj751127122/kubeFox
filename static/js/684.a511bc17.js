"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[684],{3684:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var s=a(3396),l=a(7139);const n=e=>((0,s.dD)("data-v-2d273efe"),e=e(),(0,s.Cn)(),e),i={class:"statefulset"},r=n((()=>(0,s._)("span",null,"命名空间: ",-1))),u=(0,s.Uk)("刷新"),m=(0,s.Uk)("创建"),o=(0,s.Uk)("搜索"),p={class:"statefulset-body-statefulsetname"},d=(0,s.Uk)("YAML"),c=(0,s.Uk)("删除"),g={class:"dialog-footer"},h=(0,s.Uk)("取 消"),f=(0,s.Uk)("更 新");function S(e,t,a,n,S,w){const _=(0,s.up)("el-option"),D=(0,s.up)("el-select"),b=(0,s.up)("el-col"),y=(0,s.up)("el-button"),W=(0,s.up)("el-row"),C=(0,s.up)("el-card"),k=(0,s.up)("el-input"),v=(0,s.up)("el-table-column"),z=(0,s.up)("el-tag"),V=(0,s.up)("el-popover"),x=(0,s.up)("el-table"),L=(0,s.up)("el-pagination"),U=(0,s.up)("codemirror"),Y=(0,s.up)("el-dialog"),T=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"statefulset-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",null,[r,(0,s.Wm)(D,{modelValue:S.namespaceValue,"onUpdate:modelValue":t[0]||(t[0]=e=>S.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(S.namespaceList,((e,t)=>((0,s.wg)(),(0,s.j4)(_,{key:t,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,s.Wm)(b,{span:2,offset:16},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(y,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:t[1]||(t[1]=e=>w.getStatefulSets())},{default:(0,s.w5)((()=>[u])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"statefulset-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:2},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(y,{disabled:"",style:{"border-radius":"2px"},icon:"Edit",type:"primary"},{default:(0,s.w5)((()=>[m])),_:1})])])),_:1}),(0,s.Wm)(b,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(k,{class:"statefulset-head-search",clearable:"",placeholder:"请输入",modelValue:S.searchInput,"onUpdate:modelValue":t[2]||(t[2]=e=>S.searchInput=e)},null,8,["modelValue"]),(0,s.Wm)(y,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:t[3]||(t[3]=e=>w.getStatefulSets())},{default:(0,s.w5)((()=>[o])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"statefulset-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.j4)(x,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:S.statefulSetList},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{width:"20"}),(0,s.Wm)(v,{align:"left",label:"StatefulSet名"},{default:(0,s.w5)((e=>[(0,s._)("a",p,(0,l.zw)(e.row.metadata.name),1)])),_:1}),(0,s.Wm)(v,{align:"center",label:"标签"},{default:(0,s.w5)((e=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.row.metadata.labels,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[(0,s.Wm)(V,{placement:"right",width:200,trigger:"hover",content:t+":"+e},{reference:(0,s.w5)((()=>[(0,s.Wm)(z,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(w.ellipsis(t+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,s.Wm)(v,{align:"center",label:"容器组"},{default:(0,s.w5)((e=>[(0,s._)("span",null,(0,l.zw)(e.row.status.currentReplicas>0?e.row.status.currentReplicas:0)+" / "+(0,l.zw)(e.row.spec.replicas>0?e.row.spec.replicas:0),1)])),_:1}),(0,s.Wm)(v,{align:"center","min-width":"100",label:"创建时间"},{default:(0,s.w5)((e=>[(0,s.Wm)(z,{type:"info"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(w.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,s.Wm)(v,{align:"center",label:"镜像"},{default:(0,s.w5)((e=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.row.spec.template.spec.containers,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[(0,s.Wm)(V,{placement:"right",width:200,trigger:"hover",content:e.image},{reference:(0,s.w5)((()=>[(0,s.Wm)(z,{style:{"margin-bottom":"5px"}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(w.ellipsis(void 0==e.image.split("/")[2]?e.image:e.image.split("/")[2])),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,s.Wm)(v,{align:"center",label:"操作",width:"200"},{default:(0,s.w5)((e=>[(0,s.Wm)(y,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:t=>w.getStatefulSetDetail(e)},{default:(0,s.w5)((()=>[d])),_:2},1032,["onClick"]),(0,s.Wm)(y,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:t=>w.handleConfirm(e,"删除",w.delStatefulSet)},{default:(0,s.w5)((()=>[c])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[T,S.appLoading]]),(0,s.Wm)(L,{class:"statefulset-body-pagination",background:"",onSizeChange:w.handleSizeChange,onCurrentChange:w.handleCurrentChange,"current-page":S.currentPage,"page-sizes":S.pagesizeList,"page-size":S.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:S.statefulSetTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])),_:1})])])),_:1})])),_:1}),(0,s.Wm)(Y,{title:"YAML信息",modelValue:S.yamlDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>S.yamlDialog=e),width:"45%",top:"5%"},{footer:(0,s.w5)((()=>[(0,s._)("span",g,[(0,s.Wm)(y,{onClick:t[4]||(t[4]=e=>S.yamlDialog=!1)},{default:(0,s.w5)((()=>[h])),_:1}),(0,s.Wm)(y,{type:"primary",onClick:t[5]||(t[5]=e=>w.updateStatefulSet())},{default:(0,s.w5)((()=>[f])),_:1})])])),default:(0,s.w5)((()=>[(0,s.Wm)(U,{value:S.contentYaml,border:"",options:S.cmOptions,height:"500",style:{"font-size":"14px"},onChange:w.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"])])}var w=a(7973),_=a(5959),D=a(1391),b=a(3794),y=a(4471);function W(e){return(0,y.Z)({url:"/api/k8s/statefulset/list",method:"get",params:e})}function C(e){return(0,y.Z)({url:"/api/k8s/statefulset/detail",method:"get",params:e})}function k(e){return(0,y.Z)({url:"/api/k8s/statefulset/update",method:"put",params:e})}function v(e){return(0,y.Z)({url:"/api/k8s/statefulset/del",method:"delete",params:e})}var z={data(){return{cmOptions:w.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,statefulSetList:[],statefulSetTotal:0,getStatefulSetsData:{params:{filter_name:"",namespace:"",page:"",limit:""}},statefulSetDetail:{},getStatefulSetDetailData:{params:{name:"",namespace:""}},yamlDialog:!1,updateStatefulSetData:{params:{namespace:"",content:""}},delStatefulSetData:{params:{name:"",namespace:""}}}},methods:{transYaml(e){return D.stringify(e)},transObj(e){return _.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getStatefulSets()},handleCurrentChange(e){this.currentPage=e,this.getStatefulSets()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let t=new Date(new Date(e).getTime()+288e5);return t=t.toJSON(),t=t.substring(0,19).replace("T"," "),t},restartTotal(e){let t,a=0,s=e.row.status.containerStatuses;for(t in s)a+=s[t].restartCount;return a},getNamespaces(){(0,b.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getStatefulSets(){this.appLoading=!0,this.getStatefulSetsData.params.filter_name=this.searchInput,this.getStatefulSetsData.params.namespace=this.namespaceValue,this.getStatefulSetsData.params.page=this.currentPage,this.getStatefulSetsData.params.limit=this.pagesize,W(this.getStatefulSetsData.params).then((e=>{this.statefulSetList=e.data.items,this.statefulSetTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getStatefulSetDetail(e){this.getStatefulSetDetailData.params.name=e.row.metadata.name,this.getStatefulSetDetailData.params.namespace=this.namespaceValue,C(this.getStatefulSetDetailData.params).then((e=>{this.statefulSetDetail=e.data,this.contentYaml=this.transYaml(this.statefulSetDetail),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateStatefulSet(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateStatefulSetData.params.namespace=this.namespaceValue,this.updateStatefulSetData.params.content=e,k(this.updateStatefulSetData.params).then((e=>{this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},delStatefulSet(e){this.delStatefulSetData.params.name=e.row.metadata.name,this.delStatefulSetData.params.namespace=this.namespaceValue,v(this.delStatefulSetData.params).then((e=>{this.getStatefulSets(),this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,t,a){this.confirmContent="确认继续 "+t+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{a(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getStatefulSets()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getStatefulSets()}},V=a(89);const x=(0,V.Z)(z,[["render",S],["__scopeId","data-v-2d273efe"]]);var L=x}}]);
//# sourceMappingURL=684.a511bc17.js.map