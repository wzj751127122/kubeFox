"use strict";(self["webpackChunkkube_manage_web"]=self["webpackChunkkube_manage_web"]||[]).push([[592],{9922:function(e,a,t){t.d(a,{FI:function(){return l},PY:function(){return n},Yw:function(){return r},mY:function(){return i}});var s=t(4471);function l(e){return(0,s.Z)({url:"/api/k8s/secret/list",method:"get",params:e})}function n(e){return(0,s.Z)({url:"/api/k8s/secret/detail",method:"get",params:e})}function r(e){return(0,s.Z)({url:"/api/k8s/secret/update",method:"put",params:e})}function i(e){return(0,s.Z)({url:"/api/k8s/secret/del",method:"delete",params:e})}},1592:function(e,a,t){t.r(a),t.d(a,{default:function(){return z}});var s=t(3396),l=t(7139);const n=e=>((0,s.dD)("data-v-2ae4c5ec"),e=e(),(0,s.Cn)(),e),r={class:"secret"},i=n((()=>(0,s._)("span",null,"命名空间: ",-1))),c=(0,s.Uk)("刷新"),m=(0,s.Uk)("创建"),o=(0,s.Uk)("搜索"),p={class:"secret-body-secretname"},u={style:{"overflow-y":"auto","max-height":"500px"}},d=(0,s.Uk)("YAML"),g=(0,s.Uk)("删除"),h={class:"dialog-footer"},f=(0,s.Uk)("取 消"),w=(0,s.Uk)("更 新");function _(e,a,t,n,_,S){const y=(0,s.up)("el-option"),D=(0,s.up)("el-select"),b=(0,s.up)("el-col"),W=(0,s.up)("el-button"),k=(0,s.up)("el-row"),C=(0,s.up)("el-card"),v=(0,s.up)("el-input"),z=(0,s.up)("el-table-column"),V=(0,s.up)("el-tag"),x=(0,s.up)("el-popover"),Y=(0,s.up)("reading"),L=(0,s.up)("el-icon"),I=(0,s.up)("el-table"),T=(0,s.up)("el-pagination"),U=(0,s.up)("codemirror"),$=(0,s.up)("el-dialog"),P=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(k,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"secret-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(k,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",null,[i,(0,s.Wm)(D,{modelValue:_.namespaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>_.namespaceValue=e),filterable:"",placeholder:"请选择"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(_.namespaceList,((e,a)=>((0,s.wg)(),(0,s.j4)(y,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,s.Wm)(b,{span:2,offset:16},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(W,{style:{"border-radius":"2px"},icon:"Refresh",plain:"",onClick:a[1]||(a[1]=e=>S.getSecrets())},{default:(0,s.w5)((()=>[c])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"secret-head-card",shadow:"never","body-style":{padding:"10px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(k,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{span:2},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(W,{disabled:"",style:{"border-radius":"2px"},icon:"Edit",type:"primary"},{default:(0,s.w5)((()=>[m])),_:1})])])),_:1}),(0,s.Wm)(b,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(v,{class:"secret-head-search",clearable:"",placeholder:"请输入",modelValue:_.searchInput,"onUpdate:modelValue":a[2]||(a[2]=e=>_.searchInput=e)},null,8,["modelValue"]),(0,s.Wm)(W,{style:{"border-radius":"2px"},icon:"Search",type:"primary",plain:"",onClick:a[3]||(a[3]=e=>S.getSecrets())},{default:(0,s.w5)((()=>[o])),_:1})])])),_:1})])),_:1})])),_:1})])])),_:1}),(0,s.Wm)(b,{span:24},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(C,{class:"secret-body-card",shadow:"never","body-style":{padding:"5px"}},{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.j4)(I,{style:{width:"100%","font-size":"12px","margin-bottom":"10px"},data:_.secretList},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{width:"20"}),(0,s.Wm)(z,{align:"left",label:"Secret名"},{default:(0,s.w5)((e=>[(0,s._)("a",p,(0,l.zw)(e.row.metadata.name),1)])),_:1}),(0,s.Wm)(z,{align:"center",label:"标签"},{default:(0,s.w5)((e=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.row.metadata.labels,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{key:a},[(0,s.Wm)(x,{placement:"right",width:200,trigger:"hover",content:a+":"+e},{reference:(0,s.w5)((()=>[(0,s.Wm)(V,{style:{"margin-bottom":"5px"},type:"warning"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(S.ellipsis(a+":"+e)),1)])),_:2},1024)])),_:2},1032,["content"])])))),128))])),_:1}),(0,s.Wm)(z,{align:"center",label:"DATA"},{default:(0,s.w5)((e=>[(0,s.Wm)(x,{style:{overflow:"auto"},placement:"right",width:400,trigger:"click"},{reference:(0,s.w5)((()=>[(0,s.Wm)(L,{style:{"font-size":"18px",cursor:"pointer"}},{default:(0,s.w5)((()=>[(0,s.Wm)(Y)])),_:1})])),default:(0,s.w5)((()=>[(0,s._)("div",u,[(0,s._)("span",null,(0,l.zw)(e.row.data),1)])])),_:2},1024)])),_:1}),(0,s.Wm)(z,{align:"center",prop:"type","min-width":"100",label:"类型"}),(0,s.Wm)(z,{align:"center","min-width":"100",label:"创建时间"},{default:(0,s.w5)((e=>[(0,s.Wm)(V,{type:"info"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(S.timeTrans(e.row.metadata.creationTimestamp)),1)])),_:2},1024)])),_:1}),(0,s.Wm)(z,{align:"center",label:"操作",width:"200"},{default:(0,s.w5)((e=>[(0,s.Wm)(W,{size:"small",style:{"border-radius":"2px"},icon:"Edit",type:"primary",plain:"",onClick:a=>S.getSecretDetail(e)},{default:(0,s.w5)((()=>[d])),_:2},1032,["onClick"]),(0,s.Wm)(W,{size:"small",style:{"border-radius":"2px"},icon:"Delete",type:"danger",onClick:a=>S.handleConfirm(e,"删除",S.delSecret)},{default:(0,s.w5)((()=>[g])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[P,_.appLoading]]),(0,s.Wm)(T,{class:"secret-body-pagination",background:"",onSizeChange:S.handleSizeChange,onCurrentChange:S.handleCurrentChange,"current-page":_.currentPage,"page-sizes":_.pagesizeList,layout:"total, sizes, prev, pager, next, jumper","prev-click":S.getSecrets,total:_.secretTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","prev-click","total"])])),_:1})])])),_:1})])),_:1}),(0,s.Wm)($,{title:"YAML信息",modelValue:_.yamlDialog,"onUpdate:modelValue":a[6]||(a[6]=e=>_.yamlDialog=e),width:"45%",top:"5%"},{footer:(0,s.w5)((()=>[(0,s._)("span",h,[(0,s.Wm)(W,{onClick:a[4]||(a[4]=e=>_.yamlDialog=!1)},{default:(0,s.w5)((()=>[f])),_:1}),(0,s.Wm)(W,{type:"primary",onClick:a[5]||(a[5]=e=>S.updateSecret())},{default:(0,s.w5)((()=>[w])),_:1})])])),default:(0,s.w5)((()=>[(0,s.Wm)(U,{value:_.contentYaml,border:"",options:_.cmOptions,height:"500",style:{"font-size":"14px"},onChange:S.onChange},null,8,["value","options","onChange"])])),_:1},8,["modelValue"])])}var S=t(7973),y=t(5959),D=t(1391),b=t(3794),W=t(9922),k={data(){return{cmOptions:S.Z.cmOptions,contentYaml:"",currentPage:1,pagesize:10,pagesizeList:[10,20,30],searchInput:"",namespaceValue:"default",namespaceList:[],appLoading:!1,secretList:[],secretTotal:0,getSecretsData:{params:{filter_name:"",namespace:"",page:"",limit:""}},secretDetail:{},getSecretDetailData:{params:{name:"",namespace:""}},yamlDialog:!1,updateSecretData:{params:{namespace:"",content:""}},delSecretData:{params:{secret_name:"",namespace:""}}}},methods:{transYaml(e){return D.stringify(e)},transObj(e){return y.ZP.load(e)},onChange(e){this.contentYaml=e},handleSizeChange(e){this.pagesize=e,this.getSecrets()},handleCurrentChange(e){this.currentPage=e,this.getSecrets()},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},ellipsis(e){return e.length>15?e.substring(0,15)+"...":e},timeTrans(e){let a=new Date(new Date(e).getTime()+288e5);return a=a.toJSON(),a=a.substring(0,19).replace("T"," "),a},restartTotal(e){let a,t=0,s=e.row.status.containerStatuses;for(a in s)t+=s[a].restartCount;return t},getNamespaces(){(0,b.I1)().then((e=>{this.namespaceList=e.data.items})).catch((e=>{this.$message.error({message:e.msg})}))},getSecrets(){this.appLoading=!0,this.getSecretsData.params.filter_name=this.searchInput,this.getSecretsData.params.namespace=this.namespaceValue,this.getSecretsData.params.page=this.currentPage,this.getSecretsData.params.limit=this.pagesize,(0,W.FI)(this.getSecretsData.params).then((e=>{this.secretList=e.data.items,this.secretTotal=e.data.total})).catch((e=>{this.$message.error({message:e.msg})})),this.appLoading=!1},getSecretDetail(e){this.getSecretDetailData.params.name=e.row.metadata.name,this.getSecretDetailData.params.namespace=this.namespaceValue,(0,W.PY)(this.getSecretDetailData.params).then((e=>{this.secretDetail=e.data,this.contentYaml=this.transYaml(this.secretDetail),this.yamlDialog=!0})).catch((e=>{this.$message.error({message:e.msg})}))},updateSecret(){let e=JSON.stringify(this.transObj(this.contentYaml));this.updateSecretData.params.namespace=this.namespaceValue,this.updateSecretData.params.content=e,(0,W.Yw)(this.updateSecretData.params).then((e=>{this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})})),this.yamlDialog=!1},delSecret(e){this.delSecretData.params.secret_name=e.row.metadata.name,this.delSecretData.params.namespace=this.namespaceValue,(0,W.mY)(this.delSecretData.params).then((e=>{this.getSecrets(),this.$message.success({message:e.msg})})).catch((e=>{this.$message.error({message:e.msg})}))},handleConfirm(e,a,t){this.confirmContent="确认继续 "+a+" 操作吗？",this.$confirm(this.confirmContent,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{t(e)})).catch((()=>{this.$message.info({message:"已取消操作"})}))}},watch:{namespaceValue:{handler(){localStorage.setItem("namespace",this.namespaceValue),this.currentPage=1,this.getSecrets()}}},beforeMount(){void 0!==localStorage.getItem("namespace")&&null!==localStorage.getItem("namespace")&&(this.namespaceValue=localStorage.getItem("namespace")),this.getNamespaces(),this.getSecrets()}},C=t(89);const v=(0,C.Z)(k,[["render",_],["__scopeId","data-v-2ae4c5ec"]]);var z=v}}]);
//# sourceMappingURL=592.7ea9b27a.js.map